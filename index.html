<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Dark Creed Alliance</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="loadingIndicator">Loading...</div>
    <div class="container">
      <div class="header">
        <h1>The Dark Creed Alliance</h1>
        <p class="subtitle">Unite. Strategize. Dominate.</p>
        <button
          class="btn btn-danger"
          onclick="logout()"
          id="logoutBtn"
          style="display: none"
        >
          Logout
        </button>
      </div>

      <div id="messageArea"></div>

      <!-- Timezone Confirmation Modal -->
      <div id="timezoneModal" class="modal-overlay">
        <div class="modal-content">
          <h3>üåç Confirm Your Timezone</h3>
          <p>We've detected your timezone automatically. Please confirm it's correct before proceeding:</p>
          
          <div class="timezone-info">
            <h4>üìç Detected Information</h4>
            <div class="timezone-comparison">
              <div class="timezone-item">
                <h5>Your Local Time</h5>
                <div class="time" id="userLocalTime">--:--</div>
                <div class="zone" id="userTimezone">Loading...</div>
              </div>
              <div class="timezone-item">
                <h5>Server Time</h5>
                <div class="time" id="serverTime">--:--</div>
                <div class="zone">UTC-2</div>
              </div>
            </div>
            
            <div class="time-relationship">
              <div class="relationship-text" id="timeRelationship">Calculating...</div>
            </div>
          </div>

          <p style="margin-bottom: 25px;">
            <strong>Important:</strong> Your time slot selections will be converted to server time (UTC-2) for coordination.
          </p>

          <div class="modal-buttons">
            <button class="btn btn-success" onclick="confirmTimezone()">
              ‚úÖ Confirm & Continue
            </button>
            <button class="btn" onclick="changeTimezone()">
              üîÑ Change Timezone
            </button>
          </div>
        </div>
      </div>

      <div id="authSection" class="auth-section">
        <h2>Authentication Required</h2>
        <p style="margin-bottom: 15px">
          <span id="authStatus">Not authenticated</span>
        </p>
        <div id="authControls">
          <input
            type="password"
            id="githubToken"
            placeholder="GitHub Token (required for all members)"
          />
          <button class="btn" onclick="authenticate()">
            Authenticate
          </button>
          <p style="color: #888; font-size: 14px; margin-top: 10px;">
            <strong>All members must authenticate before submitting information.</strong><br>
            Contact your alliance R4/R5 for the GitHub token.
          </p>
        </div>
      </div>

      <div class="member-form">
        <h2>Submit Your Information</h2>
        
        <!-- Timezone Status Display -->
        <div id="timezoneStatus" class="timezone-status" style="display: none;">
          <h4>‚úÖ Timezone Confirmed</h4>
          <p id="confirmedTimezoneText">--</p>
          <button class="change-btn" onclick="changeTimezone()">Change Timezone</button>
        </div>

        <!-- Timezone Locked Message -->
        <div id="timezoneLocked" class="timezone-locked-message" style="display: block;">
          <h3>üîí Timezone Setup Required</h3>
          <p>Please confirm your timezone first to enable time slot selection.</p>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>In-Game Username</label>
            <input type="text" id="username" placeholder="Your username" />
          </div>
          <div class="form-group">
            <label>Main Car Power</label>
            <input type="number" id="carPower" placeholder="e.g., 150000" />
          </div>
          <div class="form-group">
            <label>Tower Level</label>
            <input
              type="number"
              id="towerLevel"
              min="1"
              max="33"
              placeholder="1-33"
            />
          </div>
          <div class="form-group" id="manualTimezoneGroup" style="display: none;">
            <label>Timezone</label>
            <select id="timezone"></select>
            <small
              id="serverTimeInfo"
              style="color: #888; display: block; margin-top: 5px"
            ></small>
          </div>
        </div>
        <h3 style="margin: 20px 0 10px">Available Time Slots</h3>
        <p style="color: #888; margin-bottom: 15px; font-size: 14px">
          Select when you're usually available (2-hour blocks in your local time)
        </p>
        <div id="timeSlotHeaders"></div>
        <div id="timeSlotInputs"></div>
        <button class="btn btn-success" onclick="submitMemberInfo()" id="submitBtn">
          Submit Information
        </button>
      </div>

      <div class="timeline">
        <h2>Alliance Timeline (Server Time UTC-2)</h2>
        <div id="timelineView"></div>
      </div>

      <div style="margin: 40px 0 20px">
        <h2 id="allianceMembersTitle" style="color: #4a9eff; text-align: center; margin-bottom: 20px">
          Alliance Members
        </h2>
        <div class="members-grid" id="membersGrid"></div>
      </div>
    </div>
    
    <script src="script.js"></script>
  </body>
</html>
